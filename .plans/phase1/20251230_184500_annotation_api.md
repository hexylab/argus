# Issue #19: アノテーション保存 API 実装計画

**作成日時**: 2025-12-30 18:45
**Issue**: #19 #15 アノテーション保存 API
**ブランチ**: `feature/#19-annotation-api`

## 概要

アノテーションの保存・取得 API を実装する。

## 完了条件

- アノテーションの CRUD が動作する
- 一括保存ができる

## 既存リソース

- `app/models/annotation.py` - Annotation, AnnotationCreate, AnnotationUpdate スキーマ（実装済み）
- フロントエンド `types/annotation.ts` - Annotation, AnnotationCreate インターフェース

## 実装ファイル一覧

### 新規作成

| ファイル | 説明 |
|----------|------|
| `backend/app/crud/annotation.py` | アノテーション CRUD 操作 |
| `backend/app/api/v1/annotations.py` | API エンドポイント |
| `backend/tests/test_api/test_annotations.py` | API テスト |
| `backend/tests/test_crud/test_annotation.py` | CRUD テスト |

### 修正

| ファイル | 説明 |
|----------|------|
| `backend/app/api/v1/__init__.py` | annotations_router エクスポート追加 |
| `backend/app/main.py` | annotations_router 登録 |

## API エンドポイント設計

| メソッド | エンドポイント | 説明 |
|----------|----------------|------|
| POST | `/projects/{project_id}/frames/{frame_id}/annotations` | アノテーション作成 |
| GET | `/projects/{project_id}/frames/{frame_id}/annotations` | フレームのアノテーション一覧 |
| GET | `/projects/{project_id}/frames/{frame_id}/annotations/{annotation_id}` | 個別取得 |
| PATCH | `/projects/{project_id}/frames/{frame_id}/annotations/{annotation_id}` | 更新 |
| DELETE | `/projects/{project_id}/frames/{frame_id}/annotations/{annotation_id}` | 削除 |
| PUT | `/projects/{project_id}/frames/{frame_id}/annotations` | 一括保存（全置換） |

## 実装順序

1. CRUD 操作 (`crud/annotation.py`)
2. API エンドポイント (`api/v1/annotations.py`)
3. ルーター登録
4. CRUD テスト
5. API テスト
6. lint/typecheck/test 確認

## 認可ロジック

- プロジェクト所有者のみがアノテーションを操作可能
- フレームがプロジェクトに属することを確認
- ラベルがプロジェクトに属することを確認

## 注意事項

- `created_by` は認証ユーザーの ID を自動設定
- 一括保存では既存アノテーションを削除して新規作成
- bbox 値は 0-1 の正規化座標
