# Issue #14: 映像アップロード・一覧 UI 実装計画

**作成日時**: 2025-12-29 23:29
**Issue**: #14 (#13a 映像アップロード・一覧 UI)
**ブランチ**: `feature/#14-video-upload-ui`

## 概要

プロジェクト詳細ページに映像のアップロード機能と一覧表示を実装する。

## 完了条件

- 映像をドラッグ&ドロップでアップロードできる
- アップロード進捗が表示される
- 映像一覧が表示される

## Backend API (実装済み)

| メソッド | エンドポイント | 説明 |
|----------|----------------|------|
| POST | `/api/v1/projects/{project_id}/videos/upload-url` | Presigned URL を取得 |
| POST | `/api/v1/projects/{project_id}/videos/{video_id}/complete` | アップロード完了を通知 |
| GET | `/api/v1/projects/{project_id}/videos` | 映像一覧取得 |
| GET | `/api/v1/projects/{project_id}/videos/{video_id}` | 映像詳細取得 |
| DELETE | `/api/v1/projects/{project_id}/videos/{video_id}` | 映像削除 |

## 実装ファイル一覧

### 新規作成

| ファイル | 説明 |
|----------|------|
| `frontend/src/types/video.ts` | Video 型定義 |
| `frontend/src/lib/api/videos.ts` | Video API クライアント |
| `frontend/src/components/ui/progress.tsx` | shadcn/ui Progress |
| `frontend/src/app/(protected)/projects/[id]/page.tsx` | プロジェクト詳細ページ |
| `frontend/src/app/(protected)/projects/[id]/actions.ts` | Server Actions |
| `frontend/src/app/(protected)/projects/[id]/components/video-card.tsx` | 映像カード |
| `frontend/src/app/(protected)/projects/[id]/components/video-list.tsx` | 映像一覧 |
| `frontend/src/app/(protected)/projects/[id]/components/video-uploader.tsx` | アップローダー (D&D, 進捗表示) |

### 修正

| ファイル | 説明 |
|----------|------|
| `frontend/src/app/(protected)/dashboard/components/project-card.tsx` | プロジェクト詳細へのリンク追加 |

## 実装順序

### Step 1: 型定義とAPIクライアント

1. `types/video.ts` - Backend スキーマと一致させた型定義
2. `lib/api/videos.ts` - getVideos, getUploadUrl, completeUpload, deleteVideo

### Step 2: UI コンポーネント追加

```bash
pnpm dlx shadcn@latest add progress
```

### Step 3: プロジェクト詳細ページ

3. `projects/[id]/page.tsx` - プロジェクト情報 + 映像管理
4. `projects/[id]/actions.ts` - Server Actions

### Step 4: 映像コンポーネント

5. `projects/[id]/components/video-card.tsx` - 映像情報表示
6. `projects/[id]/components/video-list.tsx` - グリッド表示
7. `projects/[id]/components/video-uploader.tsx` - D&D + 進捗

### Step 5: プロジェクトカードにリンク追加

8. `dashboard/components/project-card.tsx` - Link で詳細ページへ遷移

### Step 6: テスト

9. API クライアントテスト
10. コンポーネントテスト

## 主要な型定義

```typescript
// types/video.ts
export type VideoStatus = "uploading" | "processing" | "ready" | "failed";

export interface VideoMetadata {
  codec?: string | null;
  bitrate?: number | null;
  [key: string]: unknown;
}

export interface Video {
  id: string;
  project_id: string;
  filename: string;
  original_filename: string;
  s3_key: string;
  mime_type: string | null;
  file_size: number | null;
  duration_seconds: number | null;
  width: number | null;
  height: number | null;
  fps: number | null;
  frame_count: number | null;
  status: VideoStatus;
  error_message: string | null;
  metadata: VideoMetadata;
  created_at: string;
}

export interface UploadUrlRequest {
  filename: string;
  mime_type?: string | null;
}

export interface UploadUrlResponse {
  video_id: string;
  upload_url: string;
  s3_key: string;
  expires_in: number;
}
```

## アップロードフロー

1. ユーザーがファイルをドラッグ&ドロップ
2. フロントエンドが `POST /upload-url` を呼び出し
3. Presigned URL を取得
4. フロントエンドが Presigned URL に直接 PUT でアップロード (進捗表示)
5. アップロード完了後 `POST /{video_id}/complete` を呼び出し
6. 映像一覧を revalidate

## デザイン方針

- frontend-design スキルに従い、既存の project-card.tsx のデザインパターンを踏襲
- 映像カードにはステータス表示、サムネイル（将来用プレースホルダー）、ファイル情報を表示
- アップローダーはドラッグ&ドロップエリアと進捗バーを含む

## 注意事項

- Presigned URL への直接アップロードはクライアントサイドで実行
- 複数ファイルの同時アップロード対応
- アップロード中のキャンセル対応は後続実装
- サムネイル表示は将来の Issue で対応（現時点ではプレースホルダー）
