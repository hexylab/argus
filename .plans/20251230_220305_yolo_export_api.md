# Issue #22: YOLO 形式エクスポート API 実装計画

**作成日時**: 2025-12-30 22:03
**Issue**: #22 YOLO 形式エクスポート API
**ブランチ**: `feature/#22-yolo-export-api`

## 概要

プロジェクトのアノテーションデータを YOLO 形式でエクスポートする API を実装する。

## 完了条件

- YOLO 形式のファイルが生成される
- `data.yaml` が含まれる

## YOLO 形式仕様

### アノテーションファイル (*.txt)

各画像に対応するテキストファイル。1行1アノテーション。

```
class_id center_x center_y width height
```

- `class_id`: 0から始まる整数
- `center_x`, `center_y`: バウンディングボックスの中心座標 (正規化: 0-1)
- `width`, `height`: バウンディングボックスのサイズ (正規化: 0-1)

例:
```
0 0.25 0.40 0.30 0.40
1 0.60 0.60 0.20 0.20
```

### data.yaml

```yaml
names:
  0: person
  1: car
nc: 2
```

## 座標変換

DB (左上原点) → YOLO (中心座標):
- `center_x = bbox_x + bbox_width / 2`
- `center_y = bbox_y + bbox_height / 2`

※ DB は既に正規化座標 (0-1) なので、変換不要

## API レスポンス形式

JSON で以下の構造を返す:

```json
{
  "data_yaml": "names:\n  0: person\nnc: 1\n",
  "annotations": {
    "0000.txt": "0 0.25 0.40 0.30 0.40\n",
    "0001.txt": "1 0.60 0.60 0.20 0.20\n"
  }
}
```

## 実装ファイル

### 新規作成

| ファイル | 説明 |
|----------|------|
| `backend/app/services/export/yolo.py` | YOLO 形式変換ロジック |
| `backend/tests/test_services/test_export_yolo.py` | サービステスト |

### 修正

| ファイル | 説明 |
|----------|------|
| `backend/app/services/export/__init__.py` | YOLOExporter 追加 |
| `backend/app/api/v1/export.py` | YOLO エンドポイント追加 |
| `backend/tests/test_api/test_export.py` | API テスト追加 |

## 実装順序

### Step 1: YOLO エクスポートサービス

1. `backend/app/services/export/yolo.py` 作成
   - `YOLOExporter` クラス
   - `export_project()` メソッド
   - 左上座標 → 中心座標変換

2. `backend/app/services/export/__init__.py` 修正

### Step 2: API エンドポイント

3. `backend/app/api/v1/export.py` に追加
   - GET `/projects/{project_id}/export/yolo`

### Step 3: テスト

4. `backend/tests/test_services/test_export_yolo.py` 作成
5. `backend/tests/test_api/test_export.py` に追加

### Step 4: lint/test/PR

6. lint/format/typecheck 実行
7. テスト実行
8. PR 作成

## 注意事項

- class_id は 0 から始まる (COCO は 1 から)
- 座標は正規化 (0-1) のまま出力
- アノテーションがないフレームは空の .txt ファイル
